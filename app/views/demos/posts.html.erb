<div class="bar_collection">
	<div class="bar_smoke"></div>	
	<div style="width:100%;">
		<div class="pro29">
			<a href="" data-toggle="modal" data-target="#myModal_profile_<%= @user.id %>">
				<div style="padding:10px 10px 10px 20px;display:inline-block;vertical-align:middle;">
        			<%= image_tag @user.image(:large), :class =>'img_user11' %>
        		</div>
				<div class="font_white" style="display:inline-block;vertical-align:middle;max-width:50%;word-wrap: break-word;">
        			<%= @user.name %>
        			<% if @user.authority == "public" %>
                      <%= image_tag "test55.png", :style =>'width:14px;height:14px;' %>
                    <% end %>
        		</div>
    		</a>
		</div>
		<div class="pro30">
			<div style="width:100%;text-align:right;"> 	
				<div class="btn_on" style="display:inline-block;vertical-align:middle;margin-right:10px;">
					<%= image_tag "checked_white.png", :style =>'width:12px;height:12px;margin-top:-2px;' %>
					<span style="color:#c2c2c2;"><%= @checkeds_i %></span>  checked
				</div>	
			</div>  
		</div>
	</div>		      
	<div class="tabContainer">
        <div class="tab_table">
            <div class="tab__button active">すべて</div>
            <div class="tab__button">お気に入り</div>
            <div class="tab__button">映画</div>
            <div class="tab__button">テレビ</div>
            <div class="tab__button">ブック</div>
            <div class="tab__button">コミック</div>
            <div class="tab__button">ミュージック</div>
        </div>
    </div>
</div>

<div class="main">
	<div class="cover"></div>
	<div class="block_side">
	</div>
	<div class="block_main">

		<div class="swiper-container" style="height:100%">
			<div class="swiper-wrapper" style="height:100%">
				<div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					  	<% if @all.blank? %>				  		
							<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>	
					  	<% else %>
						  	<% @all.each.with_index(1) do |post, i| %>
					  			<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">	    		
										<% if post.image_url.blank? %>
											<img data-src="/assets/nothing01.jpg" class="img_myboom lazyload_min">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom lazyload_min">
										<% end %>								
										<span>
											<div class="font_category_min">
												<% if post.category == "movie" %>
													<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> 映画
												<% end %>
												<% if post.category == "tv" %>
													<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> テレビ
												<% end %>
												<% if post.category == "book" %>
													<%= image_tag "book_gray.png", :class =>'icon_category_min' %> ブック
												<% end %>
												<% if post.category == "comic" %>
													<%= image_tag "book_gray.png", :class =>'icon_category_min' %> コミック
												<% end %>
												<% if post.category == "music" %>
													<%= image_tag "music_gray.png", :class =>'icon_category_min' %> ミュージック
												<% end %>
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
					  	<% end %>
				  	</div>
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					  	<% if @list_favorite_items.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>	
					  	<% else %>
						    <% @list_favorite_items.each.with_index(1) do |item, i| %>
						    	<% post = item.post %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing01.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>
										<span>
											<div class="font_category_min">
												<% if post.category == "movie" %>
													<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> 映画
												<% end %>
												<% if post.category == "tv" %>
													<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> テレビ
												<% end %>
												<% if post.category == "book" %>
													<%= image_tag "book_gray.png", :class =>'icon_category_min' %> ブック
												<% end %>
												<% if post.category == "comic" %>
													<%= image_tag "book_gray.png", :class =>'icon_category_min' %> コミック
												<% end %>
												<% if post.category == "music" %>
													<%= image_tag "music_gray.png", :class =>'icon_category_min' %> ミュージック
												<% end %>
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
					  	<% end %>
					</div>	
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					  	<% if @movie.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>	
					  	<% else %>
						    <% @movie.each.with_index(1) do |post, i| %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing01.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>
										<span>
											<div class="font_category_min">
												<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> 映画
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
					  	<% end %>
					</div>	
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					    <% if @tv.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>
					  	<% else %>
						  	<% @tv.each.with_index(1) do |post, i| %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing01.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>
										<span>
											<div class="font_category_min">
												<%= image_tag "movie_gray.png", :class =>'icon_category_min' %> テレビ
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
					  	<% end %>
					</div>	  	
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					    <% if @book.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>
					  	<% else %>
						  	<% @book.each.with_index(1) do |post, i| %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing02.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>
										<span>
											<div class="font_category_min">										
												<%= image_tag "book_gray.png", :class =>'icon_category_min' %> ブック
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
					  	<% end %>
					</div>			  
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					    <% if @comic.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>
					  	<% else %>
						  	<% @comic.each.with_index(1) do |post, i| %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">			
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing02.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>
										<span>
											<div class="font_category_min">
												<%= image_tag "book_gray.png", :class =>'icon_category_min' %> コミック
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>
						  	<% end %>
				  		<% end %>
				  	</div>	  	
		        </div>
		        <div class="swiper-slide" style="height:100%">
		        	<div style="height:100%;overflow-y:scroll;-webkit-overflow-scrolling: touch;">
				  		<div style="height:165px;"></div>
					    <% if @music.blank? %>
					  		<div class="font_white" style="text-align:center;margin-top:30vh;">
								<%= image_tag "warning_wihte.png", :style =>'width:20px;height:20px;margin-top:-2px;' %> 投稿がありません
							</div>	
					  	<% else %>
						  	<% @music.each.with_index(1) do |post, i| %>
						  		<div class="<%= 'test_radio_right' if i % 3 == 0 %> <%= 'test_radio' if i % 3 != 0 %>">
							    	<a data-toggle="modal" data-target="#myModal_<%= post.id %>">
										<% if post.image_url.blank? %>
											<img data-src="assets/nothing03.jpg" class="img_myboom swiper-lazy">
										<% else %>									
											<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
										<% end %>									
										<span>
											<div class="font_category_min">
												<%= image_tag "music_gray.png", :class =>'icon_category_min' %> ミュージック
											</div>
											<div class="contain_title">
												<div class="font_title_min">
													<%= post.title %>
												</div>
											</div>
										</span>
									</a>
								</div>	  		
						  	<% end %>
					  	<% end %>
					</div>			
		        </div>
			</div>
		</div>
		
	</div>
	<div class="block_side">
	</div>
</div>

<%#モーダルの中身%>
<% if @all.present? %>
	<% @all.each.with_index do |post, i| %>
		<div class="modal fade" id="myModal_<%= post.id %>">
			<div class="modal-dialog">
				<div class="base01">
					<% if post.image_url.blank? %>
						<img data-src="assets/nothing01.jpg" class="img_myboom lazyload_modal_<%= post.id %>">
					<% else %>					
						<img  data-src="<%= post.image_url %>" class="img_myboom lazyload_modal_<%= post.id %>">
					<% end %>
					<span>
						<div class="layer05">
						</div>
						<div class="layer03">
							<div class="pro31">
								<a href="" data-toggle="modal" data-target="#myModal_profile_<%= post.user.id %>">
									<div class="inline_block_default">
										<%= image_tag post.user.image(:medium), :class => "img_user04" %>
									</div>
									<div class="inline_block_default">
										<div class="font_white" style="word-wrap:break-word;">
											<%= post.user.name %>
											<% if post.user.authority == "public" %>
						                      <%= image_tag "test55.png", :style =>'width:14px;height:14px;' %>
						                    <% end %>
										</div>
										<div class="font_gray_min" style="word-wrap:break-word;">
											<% if post.category == "movie" %>
												<%= image_tag "movie_gray.png", :class =>'icon_category' %> 映画
											<% end %>
											<% if post.category == "tv" %>
												<%= image_tag "movie_gray.png", :class =>'icon_category' %> テレビ
											<% end %>
											<% if post.category == "book" %>
												<%= image_tag "book_gray.png", :class =>'icon_category' %> ブック
											<% end %>
											<% if post.category == "comic" %>
												<%= image_tag "book_gray.png", :class =>'icon_category' %> コミック
											<% end %>
											<% if post.category == "music" %>
												<%= image_tag "music_gray.png", :class =>'icon_category' %> ミュージック
											<% end %>
											<% @seconds = (Time.now - post.created_at).round  %>
											<% if @seconds <= 3600 %>
												- <%= @seconds / 60 %>分前
											<% else %>
												<% if @seconds <= 86400 %>
														- <%= @seconds / (60 * 60) %>時間前
												<% else %>
													<% if @seconds <= 604800 %>
														- <%= @seconds / (60 * 60 * 24) %>日前
													<% else %>
														- <%= post.created_at.strftime('%m月%d日') %>
													<% end %>
												<% end %>
											<% end %>
										</div>
									</div>
								</a>
							</div>						
							<div class="pro32">		
								<div style="text-align:right;">
									<a data-pushbar-target="mypushbar_<%= post.id %>" style="padding:10px;">
										<%= image_tag "ellipsis_gray.png", :style =>'width:17px;height:17px;opacity:0.7;' %>
									</a>			
								</div>
							</div>
						</div>
						<div class="layer07">
							<%= link_to "/tavore/#{post.id}/detail" do %>
								<% if post.image_url.blank? %>
									<img data-src="assets/nothing01.jpg" class="img_lavoro03 lazyload_modal_<%= post.id %>">
								<% else %>
									<img  data-src="<%= post.image_url %>" class="img_lavoro03 lazyload_modal_<%= post.id %>">
								<% end %>
							<% end %>
							<% if post.category == "music" %>
								<% if post.preview_url.present? %>
									<div class="btn_preview_default" id="btn_preview_<%= post.id %>">
										<i id="icon_play_<%= post.id %>" class="fas fa-play"></i>
									</div>
								<% end %>
							<% end %>
						</div>
						<div class="layer02">
							<%= link_to "/tavore/#{post.id}/detail" do %>
								<div class="font_how">
									<% if post.review == "bookmark" %>
										<i class="far fa-bookmark"></i> ブックマーク
									<% end %>
									<% if post.review == "good" %>
										<% if post.category == "movie" || post.category == "tv" %>
											観ました
										<% end %>
										<% if post.category == "book" || post.category == "comic" %>
											読みました
										<% end %>
										<% if post.category == "music" %>
											聴きました
										<% end %>
									<% end %>
									<% if post.review == "favorite" %>
										<i class="fas fa-star" style="color:rgba(252,228,4,0.7);"></i> おすすめしています
									<% end %>
									<% if post.review == "bad" %>
										<i class="fas fa-ban" style="color:rgba(236,12,28,0.7);"></i> おすすめしていません
									<% end %>
								</div>
								<div class="font_head">
									<%= post.title %>
								</div>
							<% end %>
							<% if post.description.present? %>
								<div class="balloon_top"></div>
								<div class="balloon">
								  	<%= safe_join(post.description.split("\n"), tag(:br)) %>
								</div>
							<% end %>
						</div>
						<div class="layer09">
							<div class="pro19">							
								<a data-dismiss="modal" id="dismiss_<%= post.id %>">
									<%= image_tag "close_blue.png", :class =>'img_left02' %>
								</a>
							</div>
						</div>
					</span>
				</div>
			</div>
		</div>
		<%# ハーフモーダル %>
		<div data-pushbar-id="mypushbar_<%= post.id %>" class="pushbar from_bottom">
			<div class="bar_pushbar"></div>	
			<% unless post.user.id == @current_user.id %>
				<span id="bookmark-of-<%= post.id %>">
			      	<%= render partial: 'works/bookmark', locals: { post: post } %>
			    </span>
				<%= link_to "/works/#{post.id}/copy" do %>
					<div class="btn_pushbar_item">  
						<%= image_tag "add_white.png", :style =>'width:16px;height:16px;margin-top:-2px;margin-right:10px;' %>この作品を投稿する
					</div>	
				<% end %>									
			<% end %>
			<% if post.user.id == @current_user.id %>
				<span id="favorite-of-<%= post.id %>">
			      	<%= render partial: 'works/favorite', locals: { post: post } %>
			    </span>		
				<span id="list-of-<%= post.id %>">
			      	<%= render partial: 'works/list', locals: { post: post } %>
			    </span>			
				<%= link_to "/works/#{post.id}/edit" do %>
					<div class="btn_pushbar_item">  
						<%= image_tag "edit_white.png", :style =>'width:16px;height:16px;margin-top:-2px;margin-right:10px;' %>投稿を編集する	 
					</div>
				<% end %>					
				<%= link_to "/works/#{post.id}/destroy", method: :post, data: { confirm: '削除しますか？' } do %>
					<div class="btn_pushbar_item" style="color:#FB473E;">  
						<%= image_tag "trash_red.png", :style =>'width:16px;height:16px;margin-top:-2px;margin-right:10px;' %>投稿を削除する
					</div>	
				<% end %>				
			<% end %>	
		    <a data-pushbar-close>
				<div class="btn_pushbar_close">  
					<%= image_tag "ban_white.png", :style =>'width:16px;height:16px;margin-top:-2px;margin-right:5px;' %>キャンセル  
				</div>
		  	</a>
		</div>
		<script>
			$('#myModal_<%= post.id %>').on("show.bs.modal", function () {
		    	$('img.lazyload_modal_<%= post.id %>').lazyload();
		    });      
		</script>
		<%#モーダルtubolinks不具合修正%>
		<script defer>
			$(function(){
				var display_<%= post.id %> = $('#myModal_<%= post.id %>').css('display');
				//モーダルが表示されているのに表示判定されてなかったら
				if(display_<%= post.id %> === 'block'){
					//モーダルを表示状態にする
					$('body').removeClass('modal-open');
      				$('.modal-backdrop').remove();				
					$('#myModal_<%= post.id %>').modal('toggle');
					//クリックでモーダルを閉じる 
					$('#dismiss_<%= post.id %>').on("click",function(){
						$('body').removeClass('modal-open');
					  	$('.modal-backdrop').remove();
						$('#myModal_<%= post.id %>').modal('hide'); 
					});
				}				
			});
		</script>
		<%# 音楽プレビューjs %>
		<% if post.category == "music" %>
			<% if post.preview_url.present? %>
				<audio id="audio_<%= post.id %>" controls preload="none" style="display:none;">
					<source src="<%= post.preview_url %>" type="audio/mpeg"></source>
				</audio>
				<script defer>						  
					$(function(){
				  	  var audio_<%= post.id %> = document.getElementById('audio_<%= post.id %>');
					  $('#btn_preview_<%= post.id %>').on("click",function(){
					    if($("#icon_play_<%= post.id %>").hasClass('fa-play'))
					     {
					       $("#icon_play_<%= post.id %>").removeClass('fa-play');
					       $("#icon_play_<%= post.id %>").addClass('fa-pause');
					       audio_<%= post.id %>.play();
					     }
					    else
					     {
					       $("#icon_play_<%= post.id %>").removeClass('fa-pause');
					       $("#icon_play_<%= post.id %>").addClass('fa-play');
					       audio_<%= post.id %>.pause();
					     }
					  });
					  audio_<%= post.id %>.onended = function() {
					    $("#icon_play_<%= post.id %>").removeClass('fa-pause');
					    $("#icon_play_<%= post.id %>").addClass('fa-play');
					  };
				  	});				
			   	</script>
			<% end %>
		<% end %>
	<% end %>
<% end %>


<%#プロフィールモーダル%>
<%= render partial: 'users/profile', locals: { user: @user, checkeds_i: @checkeds_i, bookmarks_i: @bookmarks_i } %>

<%#投稿ボタン%>
<%= render "partial/post_modal" %>


<%#タブ切り替え%>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/js/swiper.min.js"></script>
<script defer>
	$(function(){
    //タブボタンの数を取得
    var tabQuantity = $('.tab__button').length;
    //タブの長さとボディの長さの差分を取得
    var tabExtraDistance = $('.tab_table').width();
    //スライダー発動
    var swiper = new Swiper('.swiper-container', {
			speed: 600,
			touchAngle: 55,
			preloadImages: false,
			lazy: {
				loadOnTransitionStart: true,
				loadPrevNext: false,
			},
		  	on: {
			    slideChange: function () {
			      var newIndex = swiper.realIndex;
            	  slideChange(newIndex);
			    },
			  },
		});
    //スライドする時に発動する関数。タブの表示調整を行う
    function slideChange(newIndex){
        //クラスを調整
        $('.tab__button').removeClass('active');
        $('.tab_table > div:nth-child(' + ( newIndex + 1 ) + ')').addClass('active');
        //スクロールするべき距離を取得。タブ全体の長さ / ( タブの個数 - 1 ) * スライドの現在地
        var scrollDestination = ( tabExtraDistance / (tabQuantity - 1) ) * ( newIndex );
        //スクロール位置を調整
        $('.tabContainer').animate({ scrollLeft: scrollDestination }, 'slow');
    }
    //タブボタンクリックで発動する関数
    $('.tab__button').on('click',function(e){
        //何番目の要素かを取ってスライドを移動する
        var nth = $('.tab__button').index(this);
        swiper.slideTo(nth, 500, false);
        //クリックイベントを無効化
        e.preventDefault();
    })
});
</script>


<%#hammer.js%>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.js"></script>
<%#ハーフモーダル%>
<script defer>
  $(function(){
  	//overlayを削除
  	if ($('div').hasClass("pushbar_overlay")) {
	  var Back = document.querySelector('html');
	  Back.classList.remove('pushbar_locked');
	  Back.removeAttribute('pushbar');
	}
	//ハーフモーダルを削除
	if ($('.opened').hasClass("opened")) {
	  var Bar = document.querySelector('.opened');
	  Bar.classList.remove('opened');
	}
  	//ハーフモーダル生成
  	var pushbar = new Pushbar({
        overlay:true,
    });
  	//開いているとき
    $('body').on("pushbar_opening", function(){
		//スワイプ方向定義
	    var hammertime = new Hammer(document.body);
		hammertime.get('swipe').set({ direction: Hammer.DIRECTION_ALL });
	  	//スワイプイベント登録
	  	hammertime.on('swipedown', function(){
		    pushbar.close();	
		});
	});
	//閉じているとき
	$('body').on("pushbar_closing", function(){
	});
  });
</script>


<%#lazyload.js%>
<script>
	$(function() {
    	$('img.lazyload_min').lazyload();
	});
</script>