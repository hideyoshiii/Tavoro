<%#meta_tag%>
<% if @post.image_url.present? %>
	<% set_meta_tags title: "#{@post.title} | #{@post.user.name}", description: "", og: { title: "#{@post.title} | #{@post.user.name}", image: @post.image_url }, twitter: { title: "#{@post.title} | #{@post.user.name}", image: @post.image_url, card: "summary" } %>
<% else %>
	<% set_meta_tags title: "#{@post.title} | #{@post.user.name}", description: "", og: { title: "#{@post.title} | #{@post.user.name}" }, twitter: { title: "#{@post.title} | #{@post.user.name}", card: "summary" } %>
<% end %>	

<%#トップバー%>
<% if user_signed_in? %>
	<div class="bar_top">      
	    <div class="inline_block_middle" style="width:20%;">
	    	<div style="text-align:left;padding-left:15px;">
	    		<% if request.referer&.include?(request.host_with_port) %>
				  	<a href="javascript:void(0);" onclick="window.history.back();">
	          			<%= image_tag "left_FAFAFA.svg", :style =>'width:18px;height:18px;' %>
	        		</a>
				<% end %>
	      	</div>
	    </div>
	    <div class="inline_block_middle" style="width:60%;"> 	
	      	<div class="contain_title02" style="text-align:center;">
	      		<%= link_to root_path do %>
	        		<div class="neon">T<span>A</span>VO<span>RE</span></div>
	        	<% end %>
	      	</div>
	    </div>
	    <div class="inline_block_middle" style="width:20%;">
	    	<div style="text-align:right;padding-right:15px;">   			
	    		<div class="inline_block_middle"> 
		        	<a href="#" data-toggle="modal" data-target="#myModal_half_<%= @post.id %>">
		        		<%= image_tag "ellipsis_FAFAFA.svg", :style =>'width:18px;height:18px;' %>
		        	</a>
		        </div>		        
		    </div>
	    </div>
	</div>
<% else %>
	<div class="bar_top">      
	    <div class="inline_block_middle" style="width:20%;">
	    	<div style="text-align:left;padding-left:15px;">
	    		<% if request.referer&.include?(request.host_with_port) %>
				  	<a href="javascript:void(0);" onclick="window.history.back();">
	          			<%= image_tag "left_FAFAFA.svg", :style =>'width:18px;height:18px;' %>
	        		</a>  
				<% end %>
	      	</div>
	    </div>
	    <div class="inline_block_middle" style="width:60%;"> 	
	      	<div class="contain_title02" style="text-align:center;">
	      		<%= link_to root_path do %>
	        		<div class="neon">T<span>A</span>VO<span>RE</span></div>
	        	<% end %>
	      	</div>
	    </div>
	    <div class="inline_block_middle" style="width:20%;">
	    	<div style="text-align:right;padding-right:15px;">    		
	    		<div class="inline_block_middle"> 
		        	<<a href="#" data-toggle="modal" data-target="#myModal_half_<%= @post.id %>">
		        		<%= image_tag "ellipsis_FAFAFA.svg", :style =>'width:18px;height:18px;' %>
		        	</a>
		        </div>		        
		    </div>
	    </div>
	</div>
<% end %>
<div style="height:50px;"></div>
<div style="height:15px;"></div>
				
<%#作品%>
<div style="text-align:center;">
	<% if @post.image_url.blank? %>
		<%= image_tag "#{@post.category}.jpg", :style =>'width:45%;height:auto;border-radius:5px;' %>
	<% else %>	
		<% if @post.category == "music" %>
			<div class="pile_preview" style="width:45%;height:auto;">
				<%= image_tag @poster_show, :class =>'img_tavore', :style =>'border-radius:5px' %>
				<div class="btn_preview_min" id="btn_preview">
					<%= image_tag "play_FAFAFA.svg", :id =>'icon_play', :style =>'width:9px;height:9px;margin-left:0.5px;' %>
				</div>
			</div>
		<% else %>													
			<%= image_tag @poster_show, :style =>'width:45%;height:auto;border-radius:5px;' %>
		<% end %>
	<% end %>
	<div style="height:10px;"></div>
	<div style="padding:0 10%;font-size:16px;color:#FAFAFA;font-weight:bold;">
		<%= @post.title %>
	</div>
	<% if @release.present? %>
		<div class="contain_title">
			<div style="font-size:12px;color:#999999;">
				<%= @release %>
			</div>
		</div>
	<% end %>
	<% if @producer.present? %>
		<div class="contain_title">
			<div style="font-size:12px;color:#999999;">
				<%= @producer %>
			</div>
		</div>
	<% end %>
</div>
<div style="height:20px;"></div>

<%#投稿%>
<div style="margin:0px 15px;padding:20px 15px;background:-webkit-linear-gradient(-45deg,rgba(17,17,17,0.6),rgba(5,98,123,0.3));background:linear-gradient(-45deg,rgba(17,17,17,0.6),rgba(5,98,123,0.3));border-radius:5px;">
	<div class="inline_block_middle" style="width:100%;">
		<%= link_to "/#{@post.user.username}" do %>
			<div class="inline_block_middle" style="width:55px;">
	            <% if @post.user.image.present? %>
	                <img src="<%= @post.user.image(:medium) %>" class="" style="width:45px;height:45px;border-radius:50%;object-fit:cover;background:rgba(0,0,0,0.1);box-shadow:1px 1px 5px 2px rgba(0,0,0,0.2);">
	            <% else %>
	                <img src="/assets/user.jpg" class="" style="width:45px;height:45px;border-radius:50%;object-fit:cover;background:rgba(0,0,0,0.1);box-shadow:1px 1px 5px 2px rgba(0,0,0,0.2);">
	            <% end %>
			</div>
			<div class="inline_block_middle" style="width:calc(100% - 55px);">
				<div class="contain_title02">
					<div style="font-size:13px;color:#FAFAFA;word-wrap:break-word;margin-top:1px;">
						<%= @post.user.name %>
						<% if @post.user.authority == "public" %>
	                    	<img data-src="/assets/public.svg" class="icon_public_min swiper-lazy">
	                    <% end %>
					</div>
				</div>
				<div class="contain_title02">
					<div style="font-size:10px;color:#FAFAFA;opacity:0.6;word-wrap:break-word;margin-top:1px;">
						<% if @post.category == "movie" %>
							<%= image_tag "movie_FAFAFA.svg", :class =>'icon_category' %> 映画
						<% end %>
						<% if @post.category == "tv" %>
							<%= image_tag "movie_FAFAFA.svg", :class =>'icon_category' %> テレビ
						<% end %>
						<% if @post.category == "book" %>
							<%= image_tag "book_FAFAFA.svg", :class =>'icon_category' %> ブック
						<% end %>
						<% if @post.category == "comic" %>
							<%= image_tag "book_FAFAFA.svg", :class =>'icon_category' %> コミック
						<% end %>
						<% if @post.category == "music" %>
							<%= image_tag "music_FAFAFA.svg", :class =>'icon_category' %> ミュージック
						<% end %>													
						<% @seconds = (Time.now - @post.created_at).round  %>
						<% if @seconds <= 3600 %>
							- <%= @seconds / 60 %>分前
						<% else %>
							<% if @seconds <= 86400 %>
									- <%= @seconds / (60 * 60) %>時間前
							<% else %>
								<% if @seconds <= 604800 %>
									- <%= @seconds / (60 * 60 * 24) %>日前
								<% else %>
									- <%= @post.created_at.strftime('%m月%d日') %>
								<% end %>
							<% end %>
						<% end %>
					</div>
				</div>
			</div>
		<% end %>
	</div>						
	<div style="height:15px;"></div>
	<div style="font-size:12px;color:#FAFAFA;opacity:0.8;margin-left:5px">
		<% if @post.review == "bookmark" %>
			<% if @post.category == "movie" || @post.category == "tv" %>
				観たいです
			<% end %>
			<% if @post.category == "book" || @post.category == "comic" %>
				読みたいです
			<% end %>
			<% if @post.category == "music" %>
				聴きたいです
			<% end %>
		<% end %>
		<% if @post.review == "doing" %>
			<% if @post.category == "movie" || @post.category == "tv" %>
				観ています
			<% end %>
			<% if @post.category == "book" || @post.category == "comic" %>
				読んでいます
			<% end %>
			<% if @post.category == "music" %>
				聴いています
			<% end %>
		<% end %>
		<% if @post.review == "good" %>
			<% if @post.category == "movie" || @post.category == "tv" %>
				観ました
			<% end %>
			<% if @post.category == "book" || @post.category == "comic" %>
				読みました
			<% end %>
			<% if @post.category == "music" %>
				聴きました
			<% end %>
		<% end %>
		<% if @post.review == "favorite" %>
			<%= image_tag "star_F8C55A.svg", :class =>'icon_review_min' %>おすすめしています
		<% end %>
		<% if @post.review == "bad" %>
			<%= image_tag "ban_FB473E.svg", :class =>'icon_review_min' %>おすすめしていません
		<% end %>
		</div>
		<% if @post.description.present? %>
			<div style="height:10px;"></div>
			<div style="font-size:14px;color:#FAFAFA;font-weight:bold;opacity:0.8;line-height:1.4;margin:0 5px;">
				”<%= safe_join(@post.description.split("\n"), tag(:br)) %>”			
		</div>
	<% end %>
</div>
<div style="height:20px;"></div>

<%#音楽プレビューjs%>
<% if @post.preview_url.present? %>
	<audio id="audio" controls preload="none" style="display:none;">
		<source src="<%= @post.preview_url %>" type="audio/mpeg"></source>
	</audio>
	<script defer>						  
		$(function(){
	  		var audio = document.getElementById('audio');
	  		var img = $("#icon_play");
		  	$('#btn_preview').on("click",function(){
			    if(img.attr('src') === "/assets/play_FAFAFA.svg"){		     	       		       
			       	img.attr("src","/assets/pause_FAFAFA.svg");
			       	audio.play();
			    }
			    else{	     
			       	img.attr("src","/assets/play_FAFAFA.svg");
			       	audio.pause();
			    }
		  	});
		  	audio.onended = function() {
		  		img.attr("src","/assets/play_FAFAFA.svg");
		  		audio.currentTime = 0;
		  	};
	  	});				
   	</script>
<% end %>
<%#ハーフモーダル%>
<%= render partial: 'partial/modal_half', locals: { post: @post } %>
<%#クリップボード%>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.8/clipboard.min.js"></script>
<%#lazyload.js%>
<script defer>
	$(function() {
    	$('img.lazyload').lazyload();
	});
</script>
<%#ブラウザバック変更%>
<% if request.referer&.include?(request.host_with_port) %>
	<% if request.referer&.include?("edit") %>
		<script defer>
			$(function() {
		    	// 戻るボタンを押された時に何も処理を行わない
				history.pushState(null, null, null);
				// 戻るボタンを押した時の処理を追加
				window.addEventListener("popstate", function() {
				  history.go(-3);
				})
			});
		</script>
	<% end %>
<% end %>