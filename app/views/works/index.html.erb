<% if user_signed_in? %>
	<div class="main">
		<div class="block_side">
		</div>
		<div class="block_main">
			<div style="height:50px;"></div>
			<div class="swiper-container" style="height:calc(100% - 50px)">
				<div class="swiper-wrapper" style="height:100%">
					<% if @posts.present? %>
						<% @posts.each.with_index(1) do |post, i| %>
							<div class="swiper-slide" style="height:100%"> 
								<% if post.category == "music" %>
									<% if post.preview_url.present? %>
									<% end %>
							   	<% end %>
								<div class="base01">
									<% if post.image_url.blank? %>
										<img data-src="/assets/nothing01.jpg" class="img_myboom swiper-lazy">
									<% else %>										
										<img data-src="<%= post.image_url %>" class="img_myboom swiper-lazy">
									<% end %>
									<span>										
										<div class="layer05">
										</div>
										<div class="layer03">
											<div class="inline_block_middle" style="width:80%;">
												<a href="" data-toggle="modal" data-target="#myModal_profile_<%= post.user.id %>">
													<div class="inline_block_middle">
														<% if post.user.image.present? %>
											                <img data-src="<%= post.user.image(:medium) %>" class="swiper-lazy img_user04">
											            <% else %>
											                <img data-src="/assets/user09.png" class="swiper-lazy img_user04" style="box-shadow:none;">
											            <% end %>												
													</div>
													<div class="inline_block_middle">
														<div class="font_white" style="word-wrap:break-word;margin-top:2px;">
															<%= post.user.name %>
															<% if post.user.authority == "public" %>
										                      <%= image_tag "test55.png", :style =>'width:14px;height:14px;' %>
										                    <% end %>
														</div>
														<div class="font_gray_min" style="word-wrap:break-word;margin-top:2px;">
															<% if post.category == "movie" %>
																<%= image_tag "movie_gray.png", :class =>'icon_category' %> 映画
															<% end %>
															<% if post.category == "tv" %>
																<%= image_tag "movie_gray.png", :class =>'icon_category' %> テレビ
															<% end %>
															<% if post.category == "book" %>
																<%= image_tag "book_gray.png", :class =>'icon_category' %> ブック
															<% end %>
															<% if post.category == "comic" %>
																<%= image_tag "book_gray.png", :class =>'icon_category' %> コミック
															<% end %>
															<% if post.category == "music" %>
																<%= image_tag "music_gray.png", :class =>'icon_category' %> ミュージック
															<% end %>
															<% @seconds = (Time.now - post.created_at).round  %>
															<% if @seconds <= 3600 %>
																- <%= @seconds / 60 %>分前
															<% else %>
																<% if @seconds <= 86400 %>
																		- <%= @seconds / (60 * 60) %>時間前
																<% else %>
																	<% if @seconds <= 604800 %>
																		- <%= @seconds / (60 * 60 * 24) %>日前
																	<% else %>
																		- <%= post.created_at.strftime('%m月%d日') %>
																	<% end %>
																<% end %>
															<% end %>
														</div>
													</div>
												</a>
											</div>						
											<div class="inline_block_middle" style="width:20%;text-align:right;">
												<a href="" data-toggle="modal" data-target="#myModal_half_<%= post.id %>" style="padding:20px 10px 20px 20px;">
													<%= image_tag "ellipsis_gray.png", :style =>'width:17px;height:17px;opacity:0.7;' %>
												</a>														
											</div>
										</div>
										<div class="layer01">
											<%= link_to "/works/#{post.id}/detail" do %>
												<% if post.image_url.blank? %>
													<img data-src="/assets/nothing01.jpg" class="img_tavore swiper-lazy">
												<% else %>
													<img data-src="<%= post.image_url %>" class="img_tavore swiper-lazy">													
												<% end %>
											<% end %>
											<% if post.category == "music" %>
												<% if post.preview_url.present? %>
													<div class="btn_preview_default" id="btn_preview_<%= post.id %>">
														<img src="/assets/play_white.png" id="icon_play_<%= post.id %>" style="width:11px;height:11px;margin-left:0.5px;">
													</div>
												<% end %>
											<% end %>
										</div>
										<div class="layer02">
											<%= link_to "/works/#{post.id}/detail" do %>
												<div class="font_how">
													<% if post.review == "bookmark" %>
														<%= image_tag "bookmark_blue.png", :class =>'icon_review' %>ブックマーク
													<% end %>
													<% if post.review == "good" %>
														<% if post.category == "movie" || post.category == "tv" %>
															観ました
														<% end %>
														<% if post.category == "book" || post.category == "comic" %>
															読みました
														<% end %>
														<% if post.category == "music" %>
															聴きました
														<% end %>
													<% end %>
													<% if post.review == "favorite" %>
														<%= image_tag "star_yellow.png", :class =>'icon_review' %>おすすめしています
													<% end %>
													<% if post.review == "bad" %>
														<%= image_tag "ban_red.png", :class =>'icon_review' %>おすすめしていません
													<% end %>
												</div>
												<div class="font_head">
													<%= post.title %>
												</div>
											<% end %>
											<% if post.description.present? %>
												<div class="balloon_top"></div>
												<div class="balloon">
													<div>
												  		<%= safe_join(post.description.split("\n"),tag(:br)) %>
												  	</div>
												</div>
											<% end %>
										</div>
									</span>
								</div>
							</div>
						<% end %>
					<% else %>
						<%= render "partial/nothing" %>
					<% end %>
				</div>
				<div class="visible-md visible-lg">
					<div class="swiper-button-prev"></div>
					<div class="swiper-button-next"></div>
				</div>
			</div>
		</div>
		<div class="block_side">
		</div>
	</div>

	<% if @posts.present? %>
		<% @user_list = [] %>
		<% @posts.each.with_index(1) do |post, i| %>
			<%# 音楽プレビューjs %>
			<% if post.category == "music" %>
				<% if post.preview_url.present? %>
					<audio id="audio_<%= post.id %>" controls preload="none" style="display:none;">
						<source src="<%= post.preview_url %>" type="audio/mpeg"></source>
					</audio>
					<script defer>						  
						$(function(){
					  	  var audio_<%= post.id %> = document.getElementById('audio_<%= post.id %>');
					  	  var img_<%= post.id %> = $("#icon_play_<%= post.id %>");
						  $('#btn_preview_<%= post.id %>').on("click",function(){
						    if(img_<%= post.id %>.attr('src') === "/assets/play_white.png")
						     {	       		       
						       img_<%= post.id %>.attr("src","/assets/pause_white.png");
						       audio_<%= post.id %>.play();
						     }
						    else
						     {
						       img_<%= post.id %>.attr("src","/assets/play_white.png");
						       audio_<%= post.id %>.pause();
						     }
						  });
						  audio_<%= post.id %>.onended = function() {
						  	img_<%= post.id %>.attr("src","/assets/pause_white.png");
						  };
					  	});				
				   	</script>
				<% end %>
			<% end %>
			<%#ハーフモーダル%>
			<%= render partial: 'partial/modal_half', locals: { post: post } %>
			<%# プロフフィールモーダル %>
			<% unless @user_list.include?(post.user.id) %>
				<% @user = post.user %>
		  		<% @checkeds_i = Post.where(user_id: @user.id).where.not(review: "bookmark").size %>
		  		<% @bookmarks_i = Post.where(user_id: @user.id, review: "bookmark").size %>
				<%= render partial: 'partial/profile', locals: { user: @user, checkeds_i: @checkeds_i, bookmarks_i: @bookmarks_i } %>
				<% @user_list.push(post.user.id) %>
			<% end %>
		<% end %>
	<% end %>

	<%#投稿ボタン%>
	<%= render "partial/modal_post" %>

	<%#カテゴリーボタン%>
	<%= render "partial/category" %>

	<%#swiper.js%>
	<script defer src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/js/swiper.min.js"></script>
	<script defer>
		$(function(){
			var swiper = new Swiper('.swiper-container', {
				speed: 500,
				touchAngle: 55,
				navigation: {
			    	nextEl: '.swiper-button-next',
			    	prevEl: '.swiper-button-prev',
			  	},
			  	hideOnClick: false,
			  	preloadImages: false,
				lazy: {
					loadOnTransitionStart: true,
					loadPrevNext: true,
				},
			});
		});
	</script>
<%#ログインしていない時%>
<% else %>
	<%= render "partial/home" %>
<% end %>